---
title: "HW1: Sequoia National Park Climate Extremes"
author: "Katheryn Moya"
date: "4/14/2023"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(here)
library(lubridate)
```


```{r}
# read in data
sequoia_clim <- read_csv(here("HW1", "AshMt_GHCND_1927_2020.csv"))  %>% 
  janitor::clean_names()

# convert date to date class using lubridate
as.Date(sequoia_clim$date)

```

Deal with NAs
```{r}
### max temp
## values are either NA or not reasonable for that location (here, below 30F)
fillrow = which(is.na(sequoia_clim$tmax) | sequoia_clim$tmax <= 30)
fillrow = fillrow[2:length(fillrow)]
sequoia_clim$tmax[fillrow]=(sequoia_clim$tmax[fillrow+1]+sequoia_clim$tmax[fillrow-1])/2
ggplot(sequoia_clim, aes(date, sequoia_clim$tmax))+
  geom_line()+ 
  labs(y="Daily Maximum Temperature (degrees F)", x="Date")

### min temp
## appears that there is at least one min temp value that is incorrect
fillrow = which(is.na(sequoia_clim$tmin) | sequoia_clim$tmin <= 15)
fillrow = fillrow[2:length(fillrow)]
sequoia_clim$tmin[fillrow]=(sequoia_clim$tmin[fillrow+1]+sequoia_clim$tmin[fillrow-1])/2
ggplot(sequoia_clim, aes(date, sequoia_clim$tmin))+
  geom_line()+ 
  labs(y="Daily Maximum Temperature (degrees F)", x="Date")

### precip
fillrow = which((is.na(sequoia_clim$prcp)) & sequoia_clim$tmax >= 70)
## fill in data in the missing rows with zeros
sequoia_clim$prcp[fillrow]=0
```


## Extreme metrics: number of freezing days

Freezing days are defined as the number of days (per year) with minimum temperatures below freezing (32 degrees F)

```{r}
# assign a new field to the climate table called "freeze" using an `ifelse` statement

sequoia_clim$freeze <- ifelse(sequoia_clim$tmin <= 32, 1, 0) # if yes, value of 1, if no, value of 0

# group data by year and put into a new dataframe
sequoia_freeze = sequoia_clim %>% 
  mutate(year = lubridate::year(date)) %>% 
  group_by(year) %>% 
  summarize(n_freeze =sum(freeze, na.rm = T)) %>%
  drop_na()  

# sequoia_freeze$dt = unique(year) #unsure what to do about this, was in sam's code
    ### Yeah idk her code was weird in parts. She's trying to create a column
    ### with just the year, but I just did that with mutate and lubridate
    ### in the code above. 


# plot the number of freezing days between 1927 and 2020
ggplot(data = sequoia_freeze, aes(x = year, y = n_freeze)) +
  geom_point() +
  labs(x = "Year",
       y = "Number of Freezing Days") 

```

## Extreme metrics: hottest day of the year
```{r}
# group data by year and put into a new dataframe
sequoia_peak <- sequoia_clim %>% 
  mutate(year = lubridate::year(date)) %>% 
  group_by(year) %>% 
  summarize(hottest_day = max(tmax)) %>%
  drop_na()  

# plot the hottest day of the year  between 1927 and 2020
ggplot(data = sequoia_peak, aes(x = year, y = hottest_day)) +
  geom_point() +
  labs(x = "Year",
       y = "Temperature of Hottest Day of the Year")  #
```

## Extreme metrics: (something with precipitation/ drought?)
```{r}
# return period

# assign a new field to the climate table called "flood" using an `ifelse` statement
sequoia_clim$flood <- ifelse(sequoia_clim$prcp >= 1, 1, 0) 
mutate(sequoia_clim, year = lubridate::year(date))

nyrs = length(unique(year(sequoia_clim$date)))
  # [1] 94
retper=(nyrs+1)/sum(sequoia_clim$flood,na.rm=TRUE)
  # [1] 0.138484
```


