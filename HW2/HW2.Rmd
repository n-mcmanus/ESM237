---
title: "HW2"
author: "Nick McManus"
date: "2023-04-26"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

### Read in necessary packages
library(lubridate)
library(ggplot2)
library(tidyverse)
library(chron)
library(ncdf4)  ##netCDF files
library(RColorBrewer)
library(lattice)
library(abind)
```


## Read in data

```{r}
# path and filename for data
ncpath <- "data/"   # path (directory)
ncname <- "ts_Amon_GISS-E2-1-G_historical_r2i1p1f2_gn_185001-190012.nc"  # CESM1 filename
ncfname <- paste(ncpath, ncname, sep="")
dname <- "ts"  # this is the name of the variable you want to look at

ncin <- nc_open(ncfname)
print(ncin)
```


Merge historical/SSP3 data for NASA GISS

```{r}
# path and filename for data
ncpath <- "data/"   # path (directory)
dname <- "ts"  # this is the name of the variable you want to look at

ncname1 <- "ts_Amon_GISS-E2-1-G_historical_r2i1p1f2_gn_185001-190012.nc"
ncname2 <- "ts_Amon_GISS-E2-1-G_historical_r2i1p1f2_gn_190101-195012.nc"
ncname3 <- "ts_Amon_GISS-E2-1-G_historical_r2i1p1f2_gn_195101-200012.nc"
ncname4 <- "ts_Amon_GISS-E2-1-G_historical_r2i1p1f2_gn_200101-201412.nc"
ncname5 <- "ts_Amon_GISS-E2-1-G_ssp370_r1i1p3f1_gn_201501-205012.nc"
ncname6 <- "ts_Amon_GISS-E2-1-G_ssp370_r1i1p3f1_gn_205101-210012.nc"

ncfname1 <- paste(ncpath, ncname1, sep="")
ncfname2 <- paste(ncpath, ncname2, sep="")
ncfname3 <- paste(ncpath, ncname3, sep="")
ncfname4 <- paste(ncpath, ncname4, sep="")
ncfname5 <- paste(ncpath, ncname5, sep="")
ncfname6 <- paste(ncpath, ncname6, sep="")

ncin_giss1 <- nc_open(ncfname1)
ncin_giss2 <- nc_open(ncfname2)
ncin_giss3 <- nc_open(ncfname3)
ncin_giss4 <- nc_open(ncfname4)
ncin_giss5 <- nc_open(ncfname5)
ncin_giss6 <- nc_open(ncfname6)
# print(ncin_giss1)

# Get tas information from all files
tas1 <- ncvar_get(ncin_giss1, "ts")
tas2 <- ncvar_get(ncin_giss2, "ts")
tas3 <- ncvar_get(ncin_giss3, "ts")
tas4 <- ncvar_get(ncin_giss4, "ts")
tas5 <- ncvar_get(ncin_giss5, "ts")
tas6 <- ncvar_get(ncin_giss6, "ts")


# Concatenate tas information along the time dimension (dimension 3)
tas=abind(tas1,tas2,tas3,tas4,tas5,tas6, along=3)
```

```{r e3smtime_ssp}
rtime_giss=seq.Date(as.Date("1850/01/01"),as.Date("2100/12/01"),by="months")

```


The following commands read in the longitude and latitude information, and store the lengths of each axis in variables 'nlon' and 'nlat'.

```{r readcoords}
lon <- ncvar_get(ncin_giss1,"lon")
nlon <- dim(lon)
lat <- ncvar_get(ncin_giss1,"lat")
nlat <- dim(lat)

head(lat)
head(lon)

```


Now we can redo the lat/lon regional extraction:
```{r getreg_e3sm}
lats=which(lat >= 32 & lat <= 35)
lons=which(lon >= 241 & lon <= 243)


tsavg_giss <- apply(tas[lons,lats,],3,mean)
```



Now once again, we read in the time coordinate information. We need to concatenate the time information from the files to get a time series of the full time period:

```{r}
time1 <- ncvar_get(ncin_giss1,"time")
tunits1 <- ncatt_get(ncin_giss1,"time","units")
time2 <- ncvar_get(ncin_giss2,"time")
tunits2 <- ncatt_get(ncin_giss2,"time","units")
time3 <- ncvar_get(ncin_giss3,"time")
tunits3 <- ncatt_get(ncin_giss3,"time","units")
time4 <- ncvar_get(ncin_giss4,"time")
tunits4 <- ncatt_get(ncin_giss4,"time","units")

time=c(time1,time2,time3,time4)
print(tunits4)
```
Use chron package to split up the "tunits" values (which is a string) into year, month, and day

```{r}
tustr <- strsplit(tunits1$value, " ")
tdstr <- strsplit(unlist(tustr)[3], "-")
tmonth <- as.integer(unlist(tdstr)[2])
tday <- as.integer(unlist(tdstr)[3])
tyear <- as.integer(unlist(tdstr)[1])
rtime <- chron(time1,origin=c(tmonth, tday, tyear))
```









